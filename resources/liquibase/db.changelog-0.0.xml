<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog 
    xmlns="http://www.liquibase.org/xml/ns/dbchangelog/1.9"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog/1.9
                        http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-1.9.xsd">

<changeSet author="alma" id= "changelog-0.0.1">
    <createTable tableName="USER">
        <column name="ID" type="BIGINT" autoIncrement="true">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="EMAIL" type="VARCHAR(55)">
            <constraints nullable="false"/>
        </column>
        <column name="PASSWORD" type="VARCHAR(85)">
            <constraints nullable="false"/>
        </column>
        <column name="USER_TYPE" type="VARCHAR(55)">
            <constraints nullable="false"/>
        </column>
        <column name="STATUS" type="VARCHAR(65)">
            <constraints nullable="false"/>
        </column>
        <column name="CREATION_DATE" type="DATETIME">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="CAT_COUNTRY">
        <column name="ID" type="BIGINT" autoIncrement="true">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="COUNTRY_NAME" type="VARCHAR(100)">
            <constraints nullable="false"/>
        </column>
        <column name="COUNTRY_CODE" type="VARCHAR(10)">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="CAT_PRODUCT">
        <column name="ID" type="BIGINT" autoIncrement="true">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="PRODUCT_NAME" type="VARCHAR(85)">
            <constraints nullable="false"/>
        </column>
        <column name="PRODUCT_TYPE" type="VARCHAR(75)">
            <constraints nullable="false"/>
        </column>
        <column name="PRICE" type="INTEGER">
            <constraints nullable="false"/>
        </column>       
        <column name="DESCRIPTION" type="VARCHAR(999)">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="USER_PROPERTIES">
        <column name="USER_ID" type="BIGINT">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="NAME" type="VARCHAR(55)">
            <constraints nullable="false"/>
        </column>
        <column name="LAST_NAME" type="VARCHAR(65)">
            <constraints nullable="false"/>
        </column>
        <column name="COUNTRY_ID" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="PHONE" type="VARCHAR(20)">
            <constraints nullable="false"/>
        </column>
        <column name="ADDRESS" type="VARCHAR(90)">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="SALE">
        <column name="ID" type="BIGINT" autoIncrement="true">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="WORKER_ID" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="CLIENT_ID" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="ADMIN_ID" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="SOLD_DATE" type="DATETIME">
            <constraints nullable="false"/>
        </column>
        <column name="SALE_TYPE" type="VARCHAR(55)">
            <constraints nullable="false"/>
        </column>
        <column name="SALE_PROFIT" type="FLOAT">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="SALE_PRODUCT">
        <column name="SALE_ID" type="BIGINT">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="PRODUCT_ID" type="BIGINT">
            <constraints nullable="false"/>
        </column>
    </createTable>

    <createTable tableName="CLIENT_COMMENTS">
        <column name="SALE_ID" type="BIGINT">
            <constraints nullable="false" primaryKey="true"/>
        </column>
        <column name="CLIENT_ID" type="BIGINT">
            <constraints nullable="false"/>
        </column>
        <column name="COMMENT" type="VARCHAR(999)">
            <constraints nullable="false"/>
        </column>
    </createTable>
<!-- FOREIGN KEYS TABLE USER PROPERTIES-->
        <addForeignKeyConstraint constraintName="FK_USER_ID"
			baseTableName="USER_PROPERTIES" baseColumnNames="USER_ID"
			referencedTableName="USER" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />
        
        <addForeignKeyConstraint constraintName="FK_COUNTRY_ID"
			baseTableName="USER_PROPERTIES" baseColumnNames="COUNTRY_ID"
			referencedTableName="CAT_COUNTRY" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />

<!-- FOREIGN KEYS TABLE SALE-->
        <addForeignKeyConstraint constraintName="FK_WORKER_ID"
			baseTableName="SALE" baseColumnNames="WORKER_ID"
			referencedTableName="USER" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />
        <addForeignKeyConstraint constraintName="FK_CLIENT2_ID"
			baseTableName="SALE" baseColumnNames="CLIENT_ID"
			referencedTableName="USER" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />
        <addForeignKeyConstraint constraintName="FK_ADMIN_ID"
			baseTableName="SALE" baseColumnNames="ADMIN_ID"
			referencedTableName="USER" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />
<!--FOREIGN KEYS TABLE SALE_PRODUCT-->
        <addForeignKeyConstraint constraintName="FK_SALE_ID"
			baseTableName="SALE_PRODUCT" baseColumnNames="SALE_ID"
			referencedTableName="SALE" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />

        <addForeignKeyConstraint constraintName="FK_PRODUCT_ID"
			baseTableName="SALE_PRODUCT" baseColumnNames="PRODUCT_ID"
			referencedTableName="CAT_PRODUCT" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />       

<!--FOREIGN KEYS TABLE CLIENT_COMMENTS-->
        <addForeignKeyConstraint constraintName="FK_SALE2_ID"
			baseTableName="CLIENT_COMMENTS" baseColumnNames="SALE_ID"
			referencedTableName="SALE" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />
        <addForeignKeyConstraint constraintName="FK_CLIENT3_ID"
			baseTableName="CLIENT_COMMENTS" baseColumnNames="CLIENT_ID"
			referencedTableName="USER" referencedColumnNames="ID"
			deferrable="false" initiallyDeferred="false" onDelete="RESTRICT"
			onUpdate="RESTRICT" />

    <rollback>
        <dropTable tableName="USER_PROPERTIES"/>
        <dropTable tableName="CLIENT_COMMENTS"/>
        <dropTable tableName="SALE_PRODUCT"/>
        <dropTable tableName="CAT_COUNTRY"/>
        <dropTable tableName="CAT_PRODUCT"/>
        <dropTable tableName="SALE"/>
        <dropTable tableName="USER"/>
    </rollback>
</changeSet>
</databaseChangeLog>
